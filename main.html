<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CurioCat Explorer - Purr-fectly Weird Wikipedia</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff9a56 0%, #ffad56 50%, #ffc163 100%);
            height: 100vh;
            overflow: hidden;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><text y="20" font-size="20">üêæ</text></svg>'), auto;
        }
        
        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        /* Cat Avatar - Main Character */
        .curious-cat {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1004;
            width: 80px;
            height: 80px;
            animation: catBob 2s ease-in-out infinite;
            cursor: pointer;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            transition: all 0.3s ease;
            font-size: 4rem;
        }

        .curious-cat:hover {
            transform: translateX(-50%) scale(1.2);
            animation: catExcited 0.5s ease infinite;
        }

        .curious-cat.exploring {
            animation: catWalk 1s ease-in-out;
        }

        @keyframes catBob {
            0%, 100% { transform: translateX(-50%) translateY(0px); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        @keyframes catExcited {
            0%, 100% { transform: translateX(-50%) rotate(0deg) scale(1.2); }
            25% { transform: translateX(-50%) rotate(-5deg) scale(1.25); }
            75% { transform: translateX(-50%) rotate(5deg) scale(1.25); }
        }

        @keyframes catWalk {
            0% { transform: translateX(-50%) scale(1); }
            25% { transform: translateX(-40%) scale(1.1) rotate(10deg); }
            50% { transform: translateX(-50%) scale(1.2) rotate(0deg); }
            75% { transform: translateX(-60%) scale(1.1) rotate(-10deg); }
            100% { transform: translateX(-50%) scale(1) rotate(0deg); }
        }

        /* Cat Thoughts Bubble */
        .cat-thoughts {
            position: absolute;
            top: 110px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1003;
            max-width: 200px;
            text-align: center;
        }

        .cat-thoughts.show {
            opacity: 1;
            transform: translateX(-50%) translateY(-10px);
        }

        .cat-thoughts::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 30%;
            border: 8px solid transparent;
            border-top-color: rgba(255, 255, 255, 0.95);
        }

        /* Floating Action Buttons - Cat Themed */
        .floating-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1002;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .cat-btn {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .cat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            background: white;
        }

        .pounce-btn {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            animation: catTailWag 1.5s ease-in-out infinite;
        }

        .prowl-btn {
            background: linear-gradient(135deg, #a8e6cf, #00b894);
            color: white;
        }

        .nap-btn {
            background: linear-gradient(135deg, #dda0dd, #9b59b6);
            color: white;
        }

        /* Description Refresh Toggle */
        .toggle-container {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: rgba(255, 154, 86, 0.1);
            border-radius: 10px;
        }

        .toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: #ff9a56;
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        @keyframes catTailWag {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(2deg); }
            75% { transform: rotate(-2deg); }
        }

        /* Cat Footprint Trails */
        .paw-prints {
            position: absolute;
            pointer-events: none;
            z-index: 1001;
            font-size: 1.5rem;
            opacity: 0;
            animation: pawFade 2s ease-out forwards;
        }

        @keyframes pawFade {
            0% { opacity: 1; transform: scale(1.2); }
            100% { opacity: 0; transform: scale(0.8); }
        }

        /* Cat Footprint Map Markers */
        .footprint-marker {
            background: none !important;
            border: none !important;
            font-size: 1.8rem;
            text-align: center;
            animation: footprintGlow 2s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .footprint-marker:hover {
            transform: scale(1.3);
            filter: drop-shadow(0 0 15px rgba(255, 154, 86, 0.8));
        }

        @keyframes footprintGlow {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Enhanced Map Container with Cat Elements */
        .map-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.1) 2px, transparent 2px),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.1) 2px, transparent 2px);
            background-size: 150px 150px;
            animation: drift 25s linear infinite;
            pointer-events: none;
            z-index: 1;
        }

        @keyframes drift {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(-150px) translateY(-150px); }
        }
        
        .sidebar {
            width: 380px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 2px 0 20px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .sidebar-header {
            padding: 20px;
            background: linear-gradient(135deg, #ff9a56 0%, #ffad56 100%);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .sidebar-header::before {
            content: '‚ú®';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.5rem;
            animation: twinkle 1.5s ease-in-out infinite alternate;
        }

        .sidebar-header::after {
            content: 'üêæ';
            position: absolute;
            bottom: 10px;
            left: 15px;
            font-size: 1.2rem;
            animation: pawPrint 2s ease-in-out infinite;
        }

        @keyframes pawPrint {
            0%, 100% { opacity: 0.6; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        @keyframes twinkle {
            0% { opacity: 0.4; transform: rotate(0deg) scale(1); }
            100% { opacity: 1; transform: rotate(180deg) scale(1.2); }
        }
        
        .sidebar-header h1 {
            font-size: 1.8rem;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .sidebar-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .sidebar-content {
            padding: 20px;
        }
        
        .country-info {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 154, 86, 0.1);
            border-radius: 15px;
            border-left: 4px solid #ff9a56;
            animation: slideInLeft 0.5s ease;
            position: relative;
        }

        .country-info::before {
            content: 'üê±';
            position: absolute;
            top: -5px;
            right: 10px;
            font-size: 2rem;
            animation: catCurious 2s ease-in-out infinite;
        }

        @keyframes catCurious {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .country-info h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }
        
        .country-info p {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Enhanced data indicators */
        .curiosity-indicator {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: rgba(255, 154, 86, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            margin: 4px 2px;
        }

        .curiosity-very-high { background: #ff4757; color: white; }
        .curiosity-high { background: #ff6b35; color: white; }
        .curiosity-medium { background: #ffa502; color: white; }
        .curiosity-low { background: #747d8c; color: white; }

        /* Thumbnail hover overlay */
        .thumbnail-overlay {
            position: fixed;
            z-index: 10000;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 10px;
            pointer-events: none;
            opacity: 0;
            transform: scale(0.8);
            transition: all 0.3s ease;
            border: 3px solid #ff9a56;
            overflow: hidden;
        }

        .thumbnail-overlay img {
            display: block;
            border-radius: 10px;
            max-width: 100%;   
            height: auto;      
        }

        .thumbnail-overlay.show {
            opacity: 1;
            transform: scale(1);
        }

        .thumbnail-overlay .loading-thumbnail {
            width: 280px;
            height: 160px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, rgba(255, 154, 86, 0.1), rgba(255, 173, 86, 0.1));
            border-radius: 10px;
            color: rgba(255, 154, 86, 0.6);
            font-size: 2rem;
        }
        }
        
        .article-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .article-item {
            background: white;
            border-radius: 15px;
            padding: 18px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: slideInUp 0.5s ease;
            animation-fill-mode: both;
            border: 2px solid transparent;
        }

        .article-item:nth-child(1) { animation-delay: 0.1s; }
        .article-item:nth-child(2) { animation-delay: 0.2s; }
        .article-item:nth-child(3) { animation-delay: 0.3s; }

        .article-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 154, 86, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .article-item::after {
            content: 'üêæ';
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 1.2rem;
            opacity: 0;
            transition: all 0.3s ease;
        }

        @keyframes slideInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .article-item:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            border-color: #ff9a56;
        }

        .article-item:hover::before {
            left: 100%;
        }

        .article-item:hover::after {
            opacity: 1;
            transform: scale(1.2) rotate(15deg);
        }

        /* Article thumbnail styling - removed since thumbnails are now on hover */
        .article-content {
            flex: 1;
            min-width: 0;
        }
        
        .article-title {
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 1rem;
            line-height: 1.2;
        }
        
        .article-description {
            color: #666;
            font-size: 0.85rem;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .article-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            margin-bottom: 10px;
        }
        
        .article-link {
            display: inline-flex;
            align-items: center;
            color: #ff9a56;
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 500;
        }
        
        .article-link:hover {
            color: #ee5a24;
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            height: 100%;
            width: 100%;
            position: relative;
            z-index: 2;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: #666;
        }

        .loading-cat {
            font-size: 3rem;
            animation: catSleep 2s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes catSleep {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .error-message {
            background: #ffcccc;
            border: 1px solid #ff6666;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            text-align: center;
            color: #cc0000;
        }
        
        .stats {
            padding: 15px 20px;
            background: rgba(255, 154, 86, 0.1);
            border-top: 1px solid rgba(255, 154, 86, 0.2);
            text-align: center;
            font-size: 0.85rem;
            color: #666;
        }

        /* Welcome Message - Cat Themed */
        .welcome-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            z-index: 1005;
            backdrop-filter: blur(10px);
            animation: bounceIn 1s ease;
            border: 3px solid #ff9a56;
        }

        @keyframes bounceIn {
            0% { transform: translate(-50%, -50%) scale(0.3); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.05); }
            70% { transform: translate(-50%, -50%) scale(0.9); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .welcome-message.hidden {
            display: none;
        }

        .welcome-title {
            font-size: 1.8rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .welcome-text {
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .welcome-actions {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .welcome-btn {
            background: linear-gradient(135deg, #ff9a56, #ffad56);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .welcome-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 154, 86, 0.3);
        }

        .welcome-btn.secondary {
            background: rgba(255, 154, 86, 0.1);
            color: #ff9a56;
        }

        /* Teaser Strip - Cat Themed */
        .teaser-strip {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
            backdrop-filter: blur(10px);
            border-top: 3px solid #ff9a56;
        }

        .teaser-strip.show {
            transform: translateY(0);
        }

        .teaser-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .teaser-text {
            flex: 1;
        }

        .teaser-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .teaser-description {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        .teaser-button {
            background: #ff9a56;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .teaser-button:hover {
            background: #ee5a24;
            transform: translateY(-2px);
        }
        
        .popup-content {
            max-width: 280px;
        }
        
        .popup-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .popup-description {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .popup-link {
            display: inline-block;
            color: #ff9a56;
            text-decoration: none;
            font-size: 0.8rem;
            font-weight: 500;
            margin-top: 5px;
        }
        
        .popup-link:hover {
            color: #ee5a24;
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: absolute;
                height: 100%;
            }
            
            .floating-controls {
                top: 10px;
                right: 10px;
            }

            .curious-cat {
                width: 60px;
                height: 60px;
            }

            .welcome-message {
                margin: 20px;
                width: calc(100% - 40px);
            }

            .thumbnail-overlay {
                max-width: 250px;
                max-height: 150px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Main Cat Character -->
        <div class="curious-cat" id="curiousCat" title="Click me! I'm your guide!">üê±</div>
        
        <!-- Cat Thoughts -->
        <div class="cat-thoughts" id="catThoughts">
            Meow! Let's explore something weird! üó∫Ô∏è
        </div>

        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1>CurioCat Explorer</h1>
                <p>Purr-fectly Weird Wikipedia Discoveries</p>
            </div>
            <div class="sidebar-content">
                <div class="toggle-container">
                    <label>Static</label>
                    <label class="toggle">
                        <input type="checkbox" id="refresh-toggle">
                        <span class="slider"></span>
                    </label>
                    <label>Fresh Descriptions</label>
                </div>
                
                <div id="sidebar-body">
                    <div class="loading">
                        <div class="loading-cat">üò¥</div>
                        <p>This kitty is loading data...</p>
                        <p><small>Connecting to the weird wide web...</small></p>
                    </div>
                </div>
                <div class="stats" id="stats">
                    Connecting to backend... üêæ
                </div>
            </div>
        </div>
        
        <div class="map-container">
            <div class="floating-controls">
                <button class="cat-btn pounce-btn" id="pounceBtn" title="Let me pounce on something random!">
                    üêæ Pounce!
                </button>
                <button class="cat-btn prowl-btn" id="prowlBtn" title="Prowl for today's weird find">
                    üåô Night Prowl
                </button>
                <button class="cat-btn nap-btn" id="napBtn" title="Share my discoveries">
                    üí§ Share Nap
                </button>
            </div>

            <div id="map"></div>

            <div class="teaser-strip" id="teaserStrip">
                <div class="teaser-content">
                    <div class="teaser-text">
                        <div class="teaser-title" id="teaserTitle">üê± Sniff sniff... something interesting here!</div>
                        <div class="teaser-description" id="teaserDesc">Let me investigate this curious place...</div>
                    </div>
                    <button class="teaser-button" id="teaserBtn">
                        üêæ Let's Go!
                    </button>
                </div>
            </div>
        </div>

        <div class="welcome-message" id="welcomeMessage">
            <div class="welcome-title">üê± Meow! I'm your CurioCat guide!</div>
            <div class="welcome-text">
                I love exploring weird and wonderful places around the world! 
                Click on countries, let me pounce randomly, or hover over places to see what catches my whiskers! üêæ
            </div>
            <div class="welcome-actions">
                <button class="welcome-btn" id="startExploring">
                    üó∫Ô∏è Start Prowling
                </button>
                <button class="welcome-btn secondary" id="surpriseMe">
                    üé≤ Surprise Me!
                </button>
            </div>
        </div>
        
        <!-- Thumbnail hover overlay -->
        <div class="thumbnail-overlay" id="thumbnailOverlay">
            <div class="loading-thumbnail">üì∏</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <script>
        // Country coordinates for map markers
        const countryCoordinates = {
            "United Kingdom": [55.3781, -3.4360],
            "Japan": [36.2048, 138.2529],
            "United States": [39.8283, -98.5795],
            "Australia": [-25.2744, 133.7751],
            "Germany": [51.1657, 10.4515],
            "France": [46.2276, 2.2137],
            "Canada": [56.1304, -106.3468],
            "Brazil": [-14.2350, -51.9253],
            "China": [35.8617, 104.1954],
            "India": [20.5937, 78.9629],
            "South Africa": [-30.5595, 22.9375],
            "Egypt": [26.0975, 30.0444],
            "South Korea": [35.9078, 127.7669],
            "Thailand": [15.8700, 100.9925],
            "Indonesia": [-0.7893, 113.9213],
            "Netherlands": [52.1326, 5.2913],
            "Sweden": [60.1282, 18.6435],
            "Norway": [60.4720, 8.4689],
            "Mexico": [23.6345, -102.5528],
            "Argentina": [-38.4161, -63.6167],
            "New Zealand": [-40.9006, 174.8860],
            "Singapore": [1.3521, 103.8198],
            "Malaysia": [4.2105, 101.9758],
            "Philippines": [12.8797, 121.7740],
            "Taiwan": [23.6978, 120.9605],
            "Vietnam": [14.0583, 108.2772],
            "Turkey": [38.9637, 35.2433],
            "Italy": [41.8719, 12.5674],
            "Spain": [40.4637, -3.7492],
            "Russia": [61.5240, 105.3188],
            "Poland": [51.9194, 19.1451],
            "Belgium": [50.5039, 4.4699],
            "Greece": [39.0742, 21.8243],
            "Portugal": [39.3999, -8.2245],
            "Israel": [31.0461, 34.8516],
            "Chile": [-35.6751, -71.5430],
            "Peru": [-9.1900, -75.0152],
            "Colombia": [4.5709, -74.2973],
            "Morocco": [31.7917, -7.0926],
            "Kenya": [-0.0236, 37.9062],
            "Nigeria": [9.0820, 8.6753],
            "Ukraine": [48.3794, 31.1656]
        };

        // Cat thoughts and reactions
        const catThoughts = [
            "Meow! This looks interesting! üßê",
            "My whiskers are tingling with curiosity! ‚ú®",
            "Ooh, what weird thing did I find here? üîç",
            "This human place seems purr-culiar! üò∏",
            "Time for some feline investigation! üïµÔ∏è‚Äç‚ôÄÔ∏è",
            "My cat senses are picking up weirdness! üêæ",
            "Let's pounce on this mystery! ü¶ò",
            "Something fishy... and I LOVE fishy! üêü"
        ];

        const hoverThoughts = [
            "Sniff sniff... interesting! üëÉ",
            "My ears are perking up! üëÇ",
            "This place smells like adventure! üó∫Ô∏è",
            "Curiosity is getting the better of me! üò∫",
            "Should I investigate this? ü§î"
        ];

        const loadingThoughts = [
            "Pawing through the data... üêæ",
            "Hunting for weird articles... üêπ",
            "My whiskers are working overtime! ‚ö°",
            "Sniffing out the good stuff... üëÉ",
            "Almost caught something interesting! üé£"
        ];

        class CurioCatExplorer {
            constructor() {
                this.map = null;
                this.markers = [];
                this.footprints = new Set(); // Track visited countries
                this.currentCountry = null;
                this.data = {};
                this.hoveredMarker = null;
                this.catMood = "curious";
                this.pawPrints = [];
                this.apiBase = 'http://localhost:5000/api';
                this.availableCountries = [];
                this.thumbnailCache = new Map(); // Cache for thumbnails
                this.currentHoverTimeout = null;
                this.init();
            }

            async init() {
                this.initMap();
                this.initEventListeners();
                await this.loadInitialData();
                this.startCatBehaviors();
            }

            async loadInitialData() {
                try {
                    this.showCatThought("Connecting to my data sources... üì°");
                    
                    // Load stats and countries
                    const [statsResponse, countriesResponse] = await Promise.all([
                        fetch(`${this.apiBase}/stats`),
                        fetch(`${this.apiBase}/countries`)
                    ]);
                    
                    if (!statsResponse.ok || !countriesResponse.ok) {
                        throw new Error('Backend connection failed');
                    }
                    
                    const stats = await statsResponse.json();
                    const countriesData = await countriesResponse.json();
                    
                    this.availableCountries = countriesData.countries.map(c => c.country);
                    this.updateStats(stats);
                    this.loadMarkers();
                    this.showWelcomeMessage();
                    
                    this.showCatThought("Data loaded! Ready to explore! üéâ");
                    
                } catch (error) {
                    console.error('Error loading initial data:', error);
                    this.showError('Could not connect to backend. Make sure the Python server is running on localhost:5000');
                    this.showCatThought("Meow! Something went wrong... üòø");
                }
            }

            showError(message) {
                const sidebarBody = document.getElementById('sidebar-body');
                sidebarBody.innerHTML = `
                    <div class="error-message">
                        <h4>üê± Connection Error!</h4>
                        <p>${message}</p>
                        <p><small>Try running: <code>python curio-hybrid-backend.py</code></small></p>
                    </div>
                `;
            }

            async fetchThumbnail(articleTitle) {
                // Check cache first
                if (this.thumbnailCache.has(articleTitle)) {
                    return this.thumbnailCache.get(articleTitle);
                }

                try {
                    // Clean title for Wikipedia API
                    const cleanTitle = articleTitle.replace(/\s+/g, '_');
                    const url = `https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(cleanTitle)}`;
                    
                    const response = await fetch(url, {
                        headers: {
                            'User-Agent': 'CurioCatExplorer/1.0 (https://github.com/your-repo; your-email@example.com)'
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const thumbnailUrl = data.thumbnail?.source || null;
                        
                        // Cache the result (even if null)
                        this.thumbnailCache.set(articleTitle, thumbnailUrl);
                        return thumbnailUrl;
                    }
                } catch (error) {
                    console.error('Error fetching thumbnail:', error);
                }
                
                // Cache null result to avoid repeated failed requests
                this.thumbnailCache.set(articleTitle, null);
                return null;
            }

            showThumbnailOverlay(articleTitle, x, y) {
                const overlay = document.getElementById('thumbnailOverlay');
                
                // Position the overlay
                overlay.style.left = Math.min(x + 20, window.innerWidth - overlay.offsetWidth - 20) + 'px';
                overlay.style.top = Math.min(y - 80, window.innerHeight - overlay.offsetHeight - 20) + 'px';
                
                // Show loading state
                overlay.innerHTML = '<div class="loading-thumbnail">üì∏</div>';
                overlay.classList.add('show');
                
                // Fetch thumbnail
                this.fetchThumbnail(articleTitle).then(thumbnailUrl => {
                if (thumbnailUrl && overlay.classList.contains('show')) {
                    const img = new Image();
                    img.src = thumbnailUrl;

                    img.onload = () => {
                        const padding = 20;
                        const maxWidth = window.innerWidth - padding * 2;
                        const maxHeight = window.innerHeight - padding * 2;

                        // Natural dimensions
                        let w = img.naturalWidth;
                        let h = img.naturalHeight;

                        // Scale down if too big for viewport
                        if (w > maxWidth) {
                            h = h * (maxWidth / w);
                            w = maxWidth;
                        }
                        if (h > maxHeight) {
                            w = w * (maxHeight / h);
                            h = maxHeight;
                        }

                        overlay.style.width = w + "px";
                        overlay.style.height = h + "px";
                        overlay.innerHTML = "";
                        overlay.appendChild(img);
                    };
                } else if (overlay.classList.contains('show')) {
                    // Fallback placeholder
                    const placeholders = ['üñºÔ∏è', 'üó∫Ô∏è', 'üì∏', 'üé≠', 'üèõÔ∏è', 'üåç'];
                    const randomPlaceholder = placeholders[Math.floor(Math.random() * placeholders.length)];
                    overlay.innerHTML = `<div class="loading-thumbnail">${randomPlaceholder}</div>`;
                }
            });

            }

            hideThumbnailOverlay() {
                const overlay = document.getElementById('thumbnailOverlay');
                overlay.classList.remove('show');
            }

            startCatBehaviors() {
                // Cat randomly shows thoughts
                setInterval(() => {
                    if (Math.random() < 0.3) {
                        this.showCatThought();
                    }
                }, 5000);

                // Cat reacts to user inactivity
                setTimeout(() => {
                    if (!this.currentCountry) {
                        this.catNudge();
                    }
                }, 15000);
            }

            showCatThought(customThought = null) {
                const thoughts = document.getElementById('catThoughts');
                const randomThought = customThought || catThoughts[Math.floor(Math.random() * catThoughts.length)];
                
                thoughts.textContent = randomThought;
                thoughts.classList.add('show');
                
                setTimeout(() => {
                    thoughts.classList.remove('show');
                }, 3000);
            }

            catNudge() {
                const cat = document.getElementById('curiousCat');
                cat.classList.add('exploring');
                this.showCatThought("Hey human! Click somewhere! I'm getting bored! üòæ");
                
                setTimeout(() => {
                    cat.classList.remove('exploring');
                }, 1000);
            }

            showWelcomeMessage() {
                const welcome = document.getElementById('welcomeMessage');
                setTimeout(() => {
                    welcome.classList.add('hidden');
                }, 10000);
            }

            createPawPrint(x, y) {
                const pawPrint = document.createElement('div');
                pawPrint.className = 'paw-prints';
                pawPrint.textContent = 'üêæ';
                pawPrint.style.left = x + 'px';
                pawPrint.style.top = y + 'px';
                document.body.appendChild(pawPrint);

                setTimeout(() => {
                    pawPrint.remove();
                }, 2000);
            }

            addFootprintMarker(country, coords) {
                // Create footprint marker for visited countries
                const footprintIcon = L.divIcon({
                    html: '<div class="footprint-marker">üêæ</div>',
                    iconSize: [25, 25],
                    className: 'footprint-marker-container'
                });

                const marker = L.marker(coords, {
                    icon: footprintIcon,
                    title: `Visited: ${country}`
                }).addTo(this.map);

                marker.country = country;
                marker.isFootprint = true;

                // Add popup for footprint
                marker.bindPopup(`
                    <div class="popup-content">
                        <div class="popup-title">üêæ ${country}</div>
                        <div class="popup-description">
                            I've explored this place! My paws remember the weird things here.
                        </div>
                        <button onclick="window.curioCat.loadCountryData('${country}')" 
                                style="background: #ff9a56; color: white; border: none; padding: 5px 10px; border-radius: 10px; cursor: pointer; margin-top: 5px;">
                            üê± Revisit
                        </button>
                    </div>
                `, {
                    maxWidth: 200,
                    className: 'curiomap-popup'
                });

                return marker;
            }

            initMap() {
                this.map = L.map('map', {
                    center: [20, 0],
                    zoom: 2,
                    zoomControl: true,
                    scrollWheelZoom: true,
                    doubleClickZoom: true,
                    boxZoom: true
                });

                L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                    attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a> | CurioCat Explorer',
                    maxZoom: 19,
                    subdomains: 'abcd'
                }).addTo(this.map);

                // Add paw prints on map clicks
                this.map.on('click', (e) => {
                    this.createPawPrint(e.containerPoint.x, e.containerPoint.y);
                });

                // Make this available globally for popup buttons
                window.curioCat = this;
            }

            initEventListeners() {
                // Cat character interactions
                document.getElementById('curiousCat').addEventListener('click', () => {
                    this.exploreRandomCountry();
                    this.showCatThought("Wheee! Let's go exploring! üöÄ");
                });

                // Pounce button (random exploration)
                document.getElementById('pounceBtn').addEventListener('click', () => {
                    this.exploreRandomCountry();
                    this.showCatThought("POUNCE! Got something weird! ü¶ò");
                });

                // Night prowl button (daily weird)
                document.getElementById('prowlBtn').addEventListener('click', () => {
                    this.showDailyWeird();
                    this.showCatThought("Time for my midnight prowl... üåô");
                });

                // Nap button (share)
                document.getElementById('napBtn').addEventListener('click', () => {
                    this.shareCurrentView();
                    this.showCatThought("Sharing my favorite nap spots! üí§");
                });

                // Welcome message buttons
                document.getElementById('startExploring').addEventListener('click', () => {
                    document.getElementById('welcomeMessage').classList.add('hidden');
                    this.showCatThought("Great! Let's start our adventure! üó∫Ô∏è");
                });

                document.getElementById('surpriseMe').addEventListener('click', () => {
                    document.getElementById('welcomeMessage').classList.add('hidden');
                    this.exploreRandomCountry();
                    this.showCatThought("Surprise time! I love surprises! üéâ");
                });

                // Teaser button
                document.getElementById('teaserBtn').addEventListener('click', () => {
                    if (this.hoveredMarker && this.hoveredMarker.country) {
                        this.loadCountryData(this.hoveredMarker.country);
                        this.showCatThought("Let's investigate this mystery! üîç");
                    }
                });

                // Refresh toggle
                document.getElementById('refresh-toggle').addEventListener('change', () => {
                    if (this.currentCountry) {
                        this.loadCountryData(this.currentCountry);
                        this.showCatThought("Refreshing descriptions... üîÑ");
                    }
                });
            }

            async exploreRandomCountry() {
                if (this.availableCountries.length === 0) {
                    this.showCatThought("No countries loaded yet... üòø");
                    return;
                }

                const cat = document.getElementById('curiousCat');
                cat.classList.add('exploring');
                
                // Show loading thought
                const loadingThought = loadingThoughts[Math.floor(Math.random() * loadingThoughts.length)];
                this.showCatThought(loadingThought);
                
                setTimeout(async () => {
                    const randomCountry = this.availableCountries[Math.floor(Math.random() * this.availableCountries.length)];
                    
                    const coords = countryCoordinates[randomCountry];
                    if (coords) {
                        this.map.setView(coords, 5);
                        await this.loadCountryData(randomCountry);
                    }
                    
                    cat.classList.remove('exploring');
                }, 1000);
            }

            async showDailyWeird() {
                if (this.availableCountries.length === 0) return;
                
                const today = new Date().getDate();
                const dailyCountry = this.availableCountries[today % this.availableCountries.length];
                
                const coords = countryCoordinates[dailyCountry];
                if (coords) {
                    this.map.setView(coords, 5);
                    await this.loadCountryData(dailyCountry);
                }
                
                this.showNotification(`üåô Tonight's prowl destination: ${dailyCountry}!`);
            }

            shareCurrentView() {
                const url = window.location.href;
                const shareData = {
                    title: 'CurioCat Explorer - Weird Places I Found!',
                    text: `Join me on my purr-fectly weird adventure around the world! Currently exploring: ${this.currentCountry || 'the world'} üê±üó∫Ô∏è`,
                    url: url
                };

                if (navigator.share) {
                    navigator.share(shareData);
                } else {
                    navigator.clipboard.writeText(`${shareData.text} ${url}`);
                    this.showNotification('Purrfect! Link copied so you can share my discoveries! üìã');
                }
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 120px;
                    right: 20px;
                    background: rgba(255, 154, 86, 0.95);
                    color: white;
                    padding: 15px 20px;
                    border-radius: 15px;
                    z-index: 9999;
                    font-weight: 600;
                    animation: slideInRight 0.3s ease;
                    max-width: 300px;
                    border: 2px solid #fff;
                `;
                notification.textContent = message;
                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.remove();
                }, 4000);
            }

            loadMarkers() {
                // Clear existing markers
                this.markers.forEach(marker => this.map.removeLayer(marker));
                this.markers = [];

                // Add markers for available countries
                this.availableCountries.forEach(country => {
                    const coords = countryCoordinates[country];
                    if (coords) {
                        // Check if this country has been visited
                        if (this.footprints.has(country)) {
                            // Add footprint marker instead
                            const footprintMarker = this.addFootprintMarker(country, coords);
                            this.markers.push(footprintMarker);
                        } else {
                            // Add regular paw marker
                            this.addCountryMarker(country, coords);
                        }
                    }
                });
            }

            addCountryMarker(country, coords) {
                // Create custom cat paw marker
                const catIcon = L.divIcon({
                    html: '<div style="font-size: 2rem; text-align: center;">üêæ</div>',
                    iconSize: [30, 30],
                    className: 'cat-marker'
                });

                const marker = L.marker(coords, {
                    icon: catIcon,
                    title: country
                }).addTo(this.map);

                marker.country = country; // Store country reference

                // Enhanced hover effects
                marker.on('mouseover', () => {
                    this.showTeaser(country);
                    this.hoveredMarker = marker;
                    const randomHover = hoverThoughts[Math.floor(Math.random() * hoverThoughts.length)];
                    this.showCatThought(randomHover);
                });

                marker.on('mouseout', () => {
                    this.hideTeaser();
                    this.hoveredMarker = null;
                });

                marker.on('click', async () => {
                    await this.loadCountryData(country);
                    this.showCatThought("Found something interesting! üò∏");
                });

                this.markers.push(marker);
            }

            showTeaser(country) {
                const strip = document.getElementById('teaserStrip');
                const title = document.getElementById('teaserTitle');
                const desc = document.getElementById('teaserDesc');
                
                title.textContent = `üê± ${country}: Mystery awaits!`;
                desc.textContent = `Click to discover what weird things I can find here...`;
                
                strip.classList.add('show');
            }

            hideTeaser() {
                const strip = document.getElementById('teaserStrip');
                strip.classList.remove('show');
            }

            async loadCountryData(country) {
                try {
                    this.currentCountry = country;
                    const refreshDescriptions = document.getElementById('refresh-toggle').checked;
                    
                    // Show loading state
                    this.showLoadingState(country);
                    
                    // Build query params
                    const params = new URLSearchParams({
                        refresh: refreshDescriptions.toString(),
                        limit: '20'
                    });
                    
                    const response = await fetch(`${this.apiBase}/country/${encodeURIComponent(country)}?${params}`);
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    if (data.articles && data.articles.length > 0) {
                        // Mark country as visited
                        this.footprints.add(country);
                        
                        this.updateSidebar(country, data.articles, refreshDescriptions);
                        
                        // Update marker popup with real data
                        const marker = this.markers.find(m => m.country === country && !m.isFootprint);
                        if (marker) {
                            const popupContent = this.createPopupContent(country, data.articles, refreshDescriptions);
                            marker.bindPopup(popupContent, {
                                maxWidth: 350,
                                className: 'curiomap-popup'
                            });
                        }
                        
                        // Convert regular marker to footprint on next reload
                        setTimeout(() => {
                            this.loadMarkers();
                        }, 500);
                    } else {
                        this.showNoArticles(country);
                    }
                    
                    this.hideTeaser();
                    
                } catch (error) {
                    console.error(`Error loading data for ${country}:`, error);
                    this.showError(`Could not load data for ${country}. Backend might be offline.`);
                    this.showCatThought("Oops! Couldn't fetch that data... üòø");
                }
            }

            showLoadingState(country) {
                const sidebarBody = document.getElementById('sidebar-body');
                sidebarBody.innerHTML = `
                    <div class="loading">
                        <div class="loading-cat">üê±</div>
                        <p>Investigating ${country}...</p>
                        <p><small>My whiskers are working hard!</small></p>
                    </div>
                `;
            }

            showNoArticles(country) {
                const sidebarBody = document.getElementById('sidebar-body');
                sidebarBody.innerHTML = `
                    <div class="loading">
                        <div class="loading-cat">üòø</div>
                        <p>No weird articles found for ${country}</p>
                        <p><small>This place might be too normal for me!</small></p>
                    </div>
                `;
            }

            createPopupContent(country, articles, refreshDescriptions) {
                const article = articles[0];
                const curiosityScore = article.curiosity_score || 5;
                
                return `
                    <div class="popup-content">
                        <div class="popup-title">üêæ ${country}</div>
                        <div class="popup-description">
                            ${articles.length} weird find${articles.length > 1 ? 's' : ''} 
                            ‚Ä¢ Curiosity Score: ${curiosityScore}/10
                        </div>
                        <div style="margin-top: 10px;">
                            <strong>${article.title}</strong><br>
                            <small>${article.description || 'A mysterious Wikipedia discovery!'}</small><br>
                            <span class="curiosity-indicator curiosity-${this.getCuriosityLevel(curiosityScore)}">
                                ${this.getCuriosityLabel(curiosityScore)}
                            </span>
                        </div>
                        <div style="margin-top: 8px;">
                            <a href="${article.url}" target="_blank" class="popup-link">
                                üêæ Investigate Further ‚Üí
                            </a>
                        </div>
                    </div>
                `;
            }

            getCuriosityLevel(score) {
                if (score >= 8) return 'very-high';
                if (score >= 6) return 'high';
                if (score >= 4) return 'medium';
                return 'low';
            }

            getCuriosityLabel(score) {
                if (score >= 8) return 'VERY WEIRD';
                if (score >= 6) return 'WEIRD';
                if (score >= 4) return 'CURIOUS';
                return 'NORMAL';
            }

            getThumbnailElement(article) {
                if (article.thumbnail && article.thumbnail.source) {
                    return `<img src="${article.thumbnail.source}" alt="${article.title}" class="article-thumbnail" onerror="this.outerHTML='<div class=&quot;article-thumbnail placeholder&quot;>üñºÔ∏è</div>'">`;
                } else {
                    // Use random cat-themed placeholder
                    const placeholders = ['üñºÔ∏è', 'üó∫Ô∏è', 'üì∏', 'üé≠', 'üèõÔ∏è', 'üåç'];
                    const randomPlaceholder = placeholders[Math.floor(Math.random() * placeholders.length)];
                    return `<div class="article-thumbnail placeholder">${randomPlaceholder}</div>`;
                }
            }

            updateSidebar(country, articles, refreshDescriptions) {
                const sidebarBody = document.getElementById('sidebar-body');
                
                // Calculate stats
                const avgCuriosityScore = articles.reduce((sum, a) => sum + (a.curiosity_score || 5), 0) / articles.length;
                
                const content = `
                    <div class="country-info">
                        <h3>üêæ ${country}</h3>
                        <p>${articles.length} weird discover${articles.length > 1 ? 'ies' : 'y'} found!</p>
                        <p><strong>Avg Curiosity:</strong> ${avgCuriosityScore.toFixed(1)}/10</p>
                    </div>
                    <div class="article-list">
                        ${articles.map((article, index) => this.createArticleCard(article, index, refreshDescriptions)).join('')}
                    </div>
                `;
                
                sidebarBody.innerHTML = content;

                // Bind click events and hover events for thumbnails
                articles.forEach(article => {
                    const card = document.querySelector(`[data-article-id="${article.id}"]`);
                    if (card) {
                        card.addEventListener('click', () => {
                            window.open(article.url, '_blank');
                            this.showCatThought("Off to read more! Learning makes me purr! üìö");
                        });

                        // Add hover events for thumbnail
                        card.addEventListener('mouseenter', (e) => {
                            if (this.currentHoverTimeout) {
                                clearTimeout(this.currentHoverTimeout);
                            }
                            this.currentHoverTimeout = setTimeout(() => {
                                this.showThumbnailOverlay(article.title, e.pageX, e.pageY);
                            }, 500); // Delay to avoid showing on quick hovers
                        });

                        card.addEventListener('mouseleave', () => {
                            if (this.currentHoverTimeout) {
                                clearTimeout(this.currentHoverTimeout);
                                this.currentHoverTimeout = null;
                            }
                            this.hideThumbnailOverlay();
                        });

                        card.addEventListener('mousemove', (e) => {
                            // Update overlay position while hovering
                            const overlay = document.getElementById('thumbnailOverlay');
                            if (overlay.classList.contains('show')) {
                                overlay.style.left = Math.min(e.pageX + 20, window.innerWidth - 320) + 'px';
                                overlay.style.top = Math.min(e.pageY - 80, window.innerHeight - 220) + 'px';
                            }
                        });
                    }
                });
            }

            createArticleCard(article, index, refreshDescriptions) {
                const curiosityScore = article.curiosity_score || 5;
                
                return `
                    <div class="article-item" data-article-id="${article.id}" style="animation-delay: ${index * 0.1}s;">
                        <div class="article-content">
                            <div class="article-title">${article.title}</div>
                            <div class="article-description">
                                ${article.description || 'A mysterious Wikipedia discovery!'}
                            </div>
                            <div class="article-meta">
                                <span class="curiosity-indicator curiosity-${this.getCuriosityLevel(curiosityScore)}">
                                    ${this.getCuriosityLabel(curiosityScore)} (${curiosityScore}/10)
                                </span>
                            </div>
                            <a href="${article.url}" target="_blank" class="article-link" onclick="event.stopPropagation();">
                                üêæ Pounce on Wikipedia ‚Üí
                            </a>
                        </div>
                    </div>
                `;
            }

            updateStats(stats) {
                const statsEl = document.getElementById('stats');
                const lastUpdated = stats.last_updated && stats.last_updated !== 'unknown' ? 
                    new Date(stats.last_updated).toLocaleDateString() : 
                    'unknown';
                
                statsEl.innerHTML = `
                    üåç ${stats.total_countries} countries explored ‚Ä¢ 
                    üìö ${stats.total_articles} weird finds ‚Ä¢ 
                    üéØ ${stats.identification_rate}% identified ‚Ä¢ 
                    üìÖ Updated: ${lastUpdated}
                `;
            }
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new CurioCatExplorer();
        });

        // Add CSS animation keyframes for slideInRight
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideInRight {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            
            .cat-marker {
                cursor: pointer !important;
                transition: all 0.3s ease;
            }
            
            .cat-marker:hover {
                transform: scale(1.5) rotate(15deg);
                filter: drop-shadow(0 0 15px rgba(255, 154, 86, 0.8));
            }

            .footprint-marker-container {
                background: none !important;
                border: none !important;
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>